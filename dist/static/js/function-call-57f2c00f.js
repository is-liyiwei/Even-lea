var k=Math.pow;import{v as _,x as O,f as W,m as ie,y as R,z as B,A as le,n as $,B as V,C as re,a as c,D as X,E as Y,G as M,H as ce,I as ue,J as N,K as G,L as J,M as Q,N as D,b as p,O as me,S as de,P as U,Q as L,R as ve,T as ge,g as fe,U as he,V as we,W as ye,X as Pe,Y as xe,Z as Ie,$ as H,a0 as j,a1 as Se,a2 as Ce,a3 as Te,a4 as ze,a5 as be,a6 as Xe}from"./index-89754b50.js";const[Ye,z]=_("image"),$e={src:String,alt:String,fit:String,position:String,round:Boolean,width:X,height:X,radius:X,lazyLoad:Boolean,iconSize:X,showError:Y,errorIcon:M("photo-fail"),iconPrefix:String,showLoading:Y,loadingIcon:M("photo")};var Le=O({name:Ye,props:$e,emits:["load","error"],setup(e,{emit:u,slots:o}){const l=W(!1),s=W(!0),d=W(),{$Lazyload:m}=ie().proxy,g=R(()=>{const n={width:B(e.width),height:B(e.height)};return le(e.radius)&&(n.overflow="hidden",n.borderRadius=B(e.radius)),n});$(()=>e.src,()=>{l.value=!1,s.value=!0});const f=n=>{s.value=!1,u("load",n)},v=n=>{l.value=!0,s.value=!1,u("error",n)},C=(n,a,w)=>w?w():c(J,{name:n,size:e.iconSize,class:a,classPrefix:e.iconPrefix},null),y=()=>{if(s.value&&e.showLoading)return c("div",{class:z("loading")},[C(e.loadingIcon,z("loading-icon"),o.loading)]);if(l.value&&e.showError)return c("div",{class:z("error")},[C(e.errorIcon,z("error-icon"),o.error)])},P=()=>{if(l.value||!e.src)return;const n={alt:e.alt,class:z("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?ce(c("img",N({ref:d},n),null),[[ue("lazy"),e.src]]):c("img",N({src:e.src,onLoad:f,onError:v},n),null)},h=({el:n})=>{const a=()=>{n===d.value&&s.value&&f()};d.value?a():G(a)},x=({el:n})=>{n===d.value&&!l.value&&v()};return m&&V&&(m.$on("loaded",h),m.$on("error",x),re(()=>{m.$off("loaded",h),m.$off("error",x)})),()=>{var n;return c("div",{class:z({round:e.round}),style:g.value},[P(),y(),(n=o.default)==null?void 0:n.call(o)])}}});const Re=Q(Le),q=e=>Math.sqrt(k(e[0].clientX-e[1].clientX,2)+k(e[0].clientY-e[1].clientY,2)),K=_("image-preview")[1];var Ze=O({props:{src:String,show:Boolean,active:Number,minZoom:D(X),maxZoom:D(X),rootWidth:D(Number),rootHeight:D(Number)},emits:["scale","close"],setup(e,{emit:u}){const o=p({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=me(),s=R(()=>{const{rootWidth:t,rootHeight:i}=e,r=i/t;return o.imageRatio>r}),d=R(()=>{const{scale:t,moveX:i,moveY:r,moving:I,zooming:T}=o,Z={transitionDuration:T||I?"0s":".3s"};if(t!==1){const ne=i/t,se=r/t;Z.transform=`scale(${t}, ${t}) translate(${ne}px, ${se}px)`}return Z}),m=R(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:i}=e,r=s.value?i/o.imageRatio:t;return Math.max(0,(o.scale*r-t)/2)}return 0}),g=R(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:i}=e,r=s.value?i:t*o.imageRatio;return Math.max(0,(o.scale*r-i)/2)}return 0}),f=t=>{t=L(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,u("scale",{scale:t,index:e.active}))},v=()=>{f(1),o.moveX=0,o.moveY=0},C=()=>{const t=o.scale>1?1:2;f(t),o.moveX=0,o.moveY=0};let y,P,h,x,n,a,w;const S=t=>{const{touches:i}=t,{offsetX:r}=l;l.start(t),y=i.length,P=o.moveX,h=o.moveY,w=Date.now(),o.moving=y===1&&o.scale!==1,o.zooming=y===2&&!r.value,o.zooming&&(x=o.scale,n=q(t.touches))},oe=t=>{const{touches:i}=t;if(l.move(t),(o.moving||o.zooming)&&U(t,!0),o.moving){const{deltaX:r,deltaY:I}=l,T=r.value+P,Z=I.value+h;o.moveX=L(T,-m.value,m.value),o.moveY=L(Z,-g.value,g.value)}if(o.zooming&&i.length===2){const r=q(i),I=x*r/n;f(I)}},te=()=>{if(y>1)return;const{offsetX:t,offsetY:i}=l,r=Date.now()-w,I=250,T=5;t.value<T&&i.value<T&&r<I&&(a?(clearTimeout(a),a=null,C()):a=setTimeout(()=>{u("close"),a=null},I))},F=t=>{let i=!1;(o.moving||o.zooming)&&(i=!0,o.moving&&P===o.moveX&&h===o.moveY&&(i=!1),t.touches.length||(o.zooming&&(o.moveX=L(o.moveX,-m.value,m.value),o.moveY=L(o.moveY,-g.value,g.value),o.zooming=!1),o.moving=!1,P=0,h=0,x=1,o.scale<1&&v(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),U(t,i),te(),l.reset()},ae=t=>{const{naturalWidth:i,naturalHeight:r}=t.target;o.imageRatio=r/i};return $(()=>e.active,v),$(()=>e.show,t=>{t||v()}),()=>{const t={loading:()=>c(ve,{type:"spinner"},null)};return c(de,{class:K("swipe-item"),onTouchstart:S,onTouchmove:oe,onTouchend:F,onTouchcancel:F},{default:()=>[c(Re,{src:e.src,fit:"contain",class:K("image",{vertical:s.value}),style:d.value,onLoad:ae},t)]})}}});const[De,b]=_("image-preview"),He=["show","transition","overlayStyle","closeOnPopstate"],We={show:Boolean,loop:Y,images:Ie(),minZoom:H(1/3),maxZoom:H(3),overlay:Y,closeable:Boolean,showIndex:Y,className:j,closeIcon:M("clear"),transition:String,beforeClose:Function,overlayClass:j,overlayStyle:Object,swipeDuration:H(300),startPosition:H(0),showIndicators:Boolean,closeOnPopstate:Y,closeIconPosition:M("top-right")};var ee=O({name:De,props:We,emits:["scale","close","closed","change","update:show"],setup(e,{emit:u,slots:o}){const l=W(),s=p({active:0,rootWidth:0,rootHeight:0}),d=()=>{if(l.value){const a=Se(l.value.$el);s.rootWidth=a.width,s.rootHeight=a.height,l.value.resize()}},m=a=>u("scale",a),g=a=>u("update:show",a),f=()=>{Ce(e.beforeClose,{args:[s.active],done:()=>g(!1)})},v=a=>{a!==s.active&&(s.active=a,u("change",a))},C=()=>{if(e.showIndex)return c("div",{class:b("index")},[o.index?o.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},y=()=>{if(o.cover)return c("div",{class:b("cover")},[o.cover()])},P=()=>c(ye,{ref:l,lazyRender:!0,loop:e.loop,class:b("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:v},{default:()=>[e.images.map(a=>c(Ze,{src:a,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,onScale:m,onClose:f},null))]}),h=()=>{if(e.closeable)return c(J,{role:"button",name:e.closeIcon,class:[b("close-icon",e.closeIconPosition),Te],onClick:f},null)},x=()=>u("closed"),n=(a,w)=>{var S;return(S=l.value)==null?void 0:S.swipeTo(a,w)};return ge({swipeTo:n}),fe(d),$([he,we],d),$(()=>e.startPosition,a=>v(+a)),$(()=>e.show,a=>{const{images:w,startPosition:S}=e;a?(v(+S),G(()=>{d(),n(+S,{immediate:!0})})):u("close",{index:s.active,url:w[s.active]})}),()=>c(xe,N({class:[b(),e.className],overlayClass:[b("overlay"),e.overlayClass],onClosed:x,"onUpdate:show":g},Pe(e,He)),{default:()=>[h(),P(),C(),y()]})}});let E;const Ee={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Me(){({instance:E}=be({setup(){const{state:e,toggle:u}=Xe(),o=()=>{e.images=[]};return()=>c(ee,N(e,{onClosed:o,"onUpdate:show":u}),null)}}))}const A=(e,u=0)=>{if(!!V)return E||Me(),e=Array.isArray(e)?{images:e,startPosition:u}:e,E.open(ze({},Ee,e)),E};A.Component=Q(ee);A.install=e=>{e.use(A.Component)};export{A as I};
